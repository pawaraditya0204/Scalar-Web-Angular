(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{3426:function(e,t,r){"use strict";r.d(t,"a",(function(){return P})),r.d(t,"b",(function(){return I}));var l,n,o=r(5),c=(r(37),r(27),r(1155),r(1224),r(1159),r(1160),r(1161),r(1162),r(2086),r(1177),r(1387)),h=r(2559),d=r(3058),m=r(2455);function P(e,t,r,l,n,o,c,h){var d,P,f,y,I,x=t.getEngine();return t.isReady=!1,n=null!==(d=n)&&void 0!==d?d:t.samplingMode,l=null!==(P=l)&&void 0!==P?P:t.type,o=null!==(f=o)&&void 0!==f?f:t.format,c=null!==(y=c)&&void 0!==y?y:t.width,h=null!==(I=h)&&void 0!==I?I:t.height,-1===l&&(l=0),new Promise((d=>{var P=new m.a("postprocess",e,null,null,1,null,n,x,!1,void 0,l,void 0,null,!1,o);P.externalTextureSamplerBinding=!0;var f=x.createRenderTargetTexture({width:c,height:h},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:n,type:l,format:o});P.getEffect().executeWhenCompiled((()=>{P.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},r.postProcessManager.directRender([P],f,!0),x.restoreDefaultFramebuffer(),x._releaseTexture(t),P&&P.dispose(),f._swapAndDie(t),t.type=l,t.format=5,t.isReady=!0,d(t)}))}))}var f=function(){var e=Object(o.a)((function*(e,t,r,l,n){var o,d=e.getScene(),P=d.getEngine();if(e.isCube){o=new m.a("lodCube","lodCube",["lod","gamma"],null,1,null,c.a.NEAREST_NEAREST_MIPNEAREST,P,!1,["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"][l])}else o=new m.a("lod","lod",["lod","gamma"],null,1,null,c.a.NEAREST_NEAREST_MIPNEAREST,P);yield new Promise((e=>{o.getEffect().executeWhenCompiled((()=>{e(0)}))}));var f=new h.a("temp",{width:t,height:r},d,!1);o.onApply=function(t){t.setTexture("textureSampler",e),t.setFloat("lod",n),t.setBool("gamma",e.gammaSpace)};var y=e.getInternalTexture();try{if(f.renderTarget&&y){var I=y.samplingMode;0!==n?e.updateSamplingMode(c.a.NEAREST_NEAREST_MIPNEAREST):e.updateSamplingMode(c.a.NEAREST_NEAREST),d.postProcessManager.directRender([o],f.renderTarget,!0),e.updateSamplingMode(I);var x=yield P.readPixels(0,0,t,r),data=new Uint8Array(x.buffer,0,x.byteLength);return P.unBindFramebuffer(f.renderTarget),data}throw Error("Render to texture failed.")}finally{f.dispose(),o.dispose()}}));return function(t,r,l,n,o){return e.apply(this,arguments)}}();function y(){return y=Object(o.a)((function*(e,t,r){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!e.isReady()&&e._texture&&(yield new Promise(((t,r)=>{null!==e._texture?e._texture.onLoadedObservable.addOnce((()=>{t(0)})):r(0)}))),yield f(e,t,r,l,n)})),y.apply(this,arguments)}var I={CreateResizedCopy:function(e,t,r){var l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=e.getScene(),o=n.getEngine(),m=new h.a("resized"+e.name,{width:t,height:r},n,!e.noMipmap,!0,e._texture.type,!1,e.samplingMode,!1);m.wrapU=e.wrapU,m.wrapV=e.wrapV,m.uOffset=e.uOffset,m.vOffset=e.vOffset,m.uScale=e.uScale,m.vScale=e.vScale,m.uAng=e.uAng,m.vAng=e.vAng,m.wAng=e.wAng,m.coordinatesIndex=e.coordinatesIndex,m.level=e.level,m.anisotropicFilteringLevel=e.anisotropicFilteringLevel,m._texture.isReady=!1,e.wrapU=c.a.CLAMP_ADDRESSMODE,e.wrapV=c.a.CLAMP_ADDRESSMODE;var P=new d.a("pass",1,null,l?c.a.BILINEAR_SAMPLINGMODE:c.a.NEAREST_SAMPLINGMODE,o,!1,0);return P.externalTextureSamplerBinding=!0,P.getEffect().executeWhenCompiled((()=>{P.onApply=function(t){t.setTexture("textureSampler",e)};var t=m.renderTarget;t&&(n.postProcessManager.directRender([P],t),o.unBindFramebuffer(t),m.disposeFramebufferObjects(),P.dispose(),m.getInternalTexture().isReady=!0)})),m},ApplyPostProcess:P,ToHalfFloat:function(e){l||(l=new Float32Array(1),n=new Int32Array(l.buffer)),l[0]=e;var t=n[0],r=t>>16&32768,o=t>>12&2047,c=t>>23&255;return c<103?r:c>142?(r|=31744,r|=(255==c?0:1)&&8388607&t):c<113?r|=((o|=2048)>>114-c)+(o>>113-c&1):(r|=c-112<<10|o>>1,r+=1&o)},FromHalfFloat:function(e){var s=(32768&e)>>15,t=(31744&e)>>10,r=1023&e;return 0===t?(s?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==t?r?NaN:1/0*(s?-1:1):(s?-1:1)*Math.pow(2,t-15)*(1+r/Math.pow(2,10))},GetTextureDataAsync:function(e,t,r){return y.apply(this,arguments)}}},3722:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return m}));var l=r(1150);r(2456),r(1175),r(1442),r(2706),r(3641),r(2522),r(2821);r(2707);var n=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],o=[()=>1,e=>e.y,e=>e.z,e=>e.x,e=>e.x*e.y,e=>e.y*e.z,e=>3*e.z*e.z-1,e=>e.x*e.z,e=>e.x*e.x-e.y*e.y],c=(e,t)=>n[e]*o[e](t),h=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class d{constructor(){this.preScaled=!1,this.l00=l.e.Zero(),this.l1_1=l.e.Zero(),this.l10=l.e.Zero(),this.l11=l.e.Zero(),this.l2_2=l.e.Zero(),this.l2_1=l.e.Zero(),this.l20=l.e.Zero(),this.l21=l.e.Zero(),this.l22=l.e.Zero()}addLight(e,t,r){l.c.Vector3[0].set(t.r,t.g,t.b);var n=l.c.Vector3[0],o=l.c.Vector3[1];n.scaleToRef(r,o),o.scaleToRef(c(0,e),l.c.Vector3[2]),this.l00.addInPlace(l.c.Vector3[2]),o.scaleToRef(c(1,e),l.c.Vector3[2]),this.l1_1.addInPlace(l.c.Vector3[2]),o.scaleToRef(c(2,e),l.c.Vector3[2]),this.l10.addInPlace(l.c.Vector3[2]),o.scaleToRef(c(3,e),l.c.Vector3[2]),this.l11.addInPlace(l.c.Vector3[2]),o.scaleToRef(c(4,e),l.c.Vector3[2]),this.l2_2.addInPlace(l.c.Vector3[2]),o.scaleToRef(c(5,e),l.c.Vector3[2]),this.l2_1.addInPlace(l.c.Vector3[2]),o.scaleToRef(c(6,e),l.c.Vector3[2]),this.l20.addInPlace(l.c.Vector3[2]),o.scaleToRef(c(7,e),l.c.Vector3[2]),this.l21.addInPlace(l.c.Vector3[2]),o.scaleToRef(c(8,e),l.c.Vector3[2]),this.l22.addInPlace(l.c.Vector3[2])}scaleInPlace(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(h[0]),this.l1_1.scaleInPlace(h[1]),this.l10.scaleInPlace(h[2]),this.l11.scaleInPlace(h[3]),this.l2_2.scaleInPlace(h[4]),this.l2_1.scaleInPlace(h[5]),this.l20.scaleInPlace(h[6]),this.l21.scaleInPlace(h[7]),this.l22.scaleInPlace(h[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(n[0]),this.l1_1.scaleInPlace(n[1]),this.l10.scaleInPlace(n[2]),this.l11.scaleInPlace(n[3]),this.l2_2.scaleInPlace(n[4]),this.l2_1.scaleInPlace(n[5]),this.l20.scaleInPlace(n[6]),this.l21.scaleInPlace(n[7]),this.l22.scaleInPlace(n[8])}updateFromArray(data){return l.e.FromArrayToRef(data[0],0,this.l00),l.e.FromArrayToRef(data[1],0,this.l1_1),l.e.FromArrayToRef(data[2],0,this.l10),l.e.FromArrayToRef(data[3],0,this.l11),l.e.FromArrayToRef(data[4],0,this.l2_2),l.e.FromArrayToRef(data[5],0,this.l2_1),l.e.FromArrayToRef(data[6],0,this.l20),l.e.FromArrayToRef(data[7],0,this.l21),l.e.FromArrayToRef(data[8],0,this.l22),this}updateFromFloatsArray(data){return l.e.FromFloatsToRef(data[0],data[1],data[2],this.l00),l.e.FromFloatsToRef(data[3],data[4],data[5],this.l1_1),l.e.FromFloatsToRef(data[6],data[7],data[8],this.l10),l.e.FromFloatsToRef(data[9],data[10],data[11],this.l11),l.e.FromFloatsToRef(data[12],data[13],data[14],this.l2_2),l.e.FromFloatsToRef(data[15],data[16],data[17],this.l2_1),l.e.FromFloatsToRef(data[18],data[19],data[20],this.l20),l.e.FromFloatsToRef(data[21],data[22],data[23],this.l21),l.e.FromFloatsToRef(data[24],data[25],data[26],this.l22),this}static FromArray(data){return(new d).updateFromArray(data)}static FromPolynomial(e){var t=new d;return t.l00=e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)),t.l1_1=e.y.scale(.977204),t.l10=e.z.scale(.977204),t.l11=e.x.scale(.977204),t.l2_2=e.xy.scale(1.16538),t.l2_1=e.yz.scale(1.16538),t.l20=e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)),t.l21=e.zx.scale(1.16538),t.l22=e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)),t.l1_1.scaleInPlace(-1),t.l11.scaleInPlace(-1),t.l2_1.scaleInPlace(-1),t.l21.scaleInPlace(-1),t.scaleInPlace(Math.PI),t}}class m{constructor(){this.x=l.e.Zero(),this.y=l.e.Zero(),this.z=l.e.Zero(),this.xx=l.e.Zero(),this.yy=l.e.Zero(),this.zz=l.e.Zero(),this.xy=l.e.Zero(),this.yz=l.e.Zero(),this.zx=l.e.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=d.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(e){l.c.Vector3[0].copyFromFloats(e.r,e.g,e.b);var t=l.c.Vector3[0];this.xx.addInPlace(t),this.yy.addInPlace(t),this.zz.addInPlace(t)}scaleInPlace(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)}updateFromHarmonics(e){return this._harmonics=e,this.x.copyFrom(e.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(e.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(e.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(e.l00),l.c.Vector3[0].copyFrom(e.l20).scaleInPlace(.247708),l.c.Vector3[1].copyFrom(e.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(l.c.Vector3[0]).addInPlace(l.c.Vector3[1]),this.yy.copyFrom(e.l00),this.yy.scaleInPlace(.886277).subtractInPlace(l.c.Vector3[0]).subtractInPlace(l.c.Vector3[1]),this.zz.copyFrom(e.l00),l.c.Vector3[0].copyFrom(e.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(l.c.Vector3[0]),this.yz.copyFrom(e.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(e.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(e.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(e){return(new m).updateFromHarmonics(e)}static FromArray(data){var e=new m;return l.e.FromArrayToRef(data[0],0,e.x),l.e.FromArrayToRef(data[1],0,e.y),l.e.FromArrayToRef(data[2],0,e.z),l.e.FromArrayToRef(data[3],0,e.xx),l.e.FromArrayToRef(data[4],0,e.yy),l.e.FromArrayToRef(data[5],0,e.zz),l.e.FromArrayToRef(data[6],0,e.yz),l.e.FromArrayToRef(data[7],0,e.zx),l.e.FromArrayToRef(data[8],0,e.xy),e}}},3860:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var l=r(2455),n=(r(3861),r(2853),r(3426));class o{static ExpandRGBDTexture(e){var t=e._texture;if(t&&e.isRGBD){var r=t.getEngine(),n=r.getCaps(),o=t.isReady,c=!1;n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering?(c=!0,t.type=2):n.textureFloatRender&&n.textureFloatLinearFiltering&&(c=!0,t.type=1),c&&(t.isReady=!1,t._isRGBD=!1,t.invertY=!1);var h=()=>{var n=new l.a("rgbdDecode","rgbdDecode",null,null,1,null,3,r,!1,void 0,t.type,void 0,null,!1);n.externalTextureSamplerBinding=!0;var o=r.createRenderTargetTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t.samplingMode,type:t.type,format:5});n.getEffect().executeWhenCompiled((()=>{n.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},e.getScene().postProcessManager.directRender([n],o,!0),r.restoreDefaultFramebuffer(),r._releaseTexture(t),n&&n.dispose(),o._swapAndDie(t),t.isReady=!0}))};c&&(o?h():e.onLoadObservable.addOnce(h))}}static EncodeTextureToRGBD(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(n.a)("rgbdEncode",e,t,r,1,5)}}},3861:function(e,t,r){"use strict";var l=r(1143),n=(r(2560),"rgbdDecodePixelShader"),o="varying vec2 vUV;uniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{gl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);}";l.a.ShadersStore[n]=o},3894:function(e,t,r){"use strict";r(37),r(27),r(29);var l=r(1150),n=r(2087),o=r(3722),c=r(1442),h=r(1175);class d{constructor(e,t,r,l){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=r,this.worldAxisForFileY=l}}class m{static ConvertCubeMapTextureToSphericalPolynomial(e){var t;if(!e.isCube)return null;null===(t=e.getScene())||void 0===t||t.getEngine().flushFramebuffer();var r,l,n=e.getSize().width,o=e.readPixels(0,void 0,void 0,!1),c=e.readPixels(1,void 0,void 0,!1);e.isRenderTarget?(r=e.readPixels(3,void 0,void 0,!1),l=e.readPixels(2,void 0,void 0,!1)):(r=e.readPixels(2,void 0,void 0,!1),l=e.readPixels(3,void 0,void 0,!1));var h=e.readPixels(4,void 0,void 0,!1),d=e.readPixels(5,void 0,void 0,!1),m=e.gammaSpace,P=0;return 1!=e.textureType&&2!=e.textureType||(P=1),new Promise((e=>{Promise.all([c,o,r,l,h,d]).then((t=>{var[r,l,o,c,h,d]=t,f={size:n,right:l,left:r,up:o,down:c,front:h,back:d,format:5,type:P,gammaSpace:m};e(this.ConvertCubeMapToSphericalPolynomial(f))}))}))}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){for(var t=new o.a,r=0,l=2/e.size,d=l,m=.5*l,P=m-1,f=0;f<6;f++)for(var y=this._FileFaces[f],I=e[y.name],x=P,_=5===e.format?4:3,v=0;v<e.size;v++){for(var u=P,F=0;F<e.size;F++){var T=y.worldAxisForFileX.scale(u).add(y.worldAxisForFileY.scale(x)).add(y.worldAxisForNormal);T.normalize();var R=this._AreaElement(u-m,x-m)-this._AreaElement(u-m,x+m)-this._AreaElement(u+m,x-m)+this._AreaElement(u+m,x+m),w=I[v*e.size*_+F*_+0],g=I[v*e.size*_+F*_+1],b=I[v*e.size*_+F*_+2];isNaN(w)&&(w=0),isNaN(g)&&(g=0),isNaN(b)&&(b=0),0===e.type&&(w/=255,g/=255,b/=255),e.gammaSpace&&(w=Math.pow(n.a.Clamp(w),c.c),g=Math.pow(n.a.Clamp(g),c.c),b=Math.pow(n.a.Clamp(b),c.c));var A=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){var M=Math.max(w,g,b);if(M>A){var E=A/M;w*=E,g*=E,b*=E}}else w=n.a.Clamp(w,0,A),g=n.a.Clamp(g,0,A),b=n.a.Clamp(b,0,A);var S=new h.a(w,g,b);t.addLight(T,S,R),r+=R,u+=l}x+=d}var z=6*(4*Math.PI)/6/r;return t.scaleInPlace(z),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),o.b.FromHarmonics(t)}}m._FileFaces=[new d("right",new l.e(1,0,0),new l.e(0,0,-1),new l.e(0,-1,0)),new d("left",new l.e(-1,0,0),new l.e(0,0,1),new l.e(0,-1,0)),new d("up",new l.e(0,1,0),new l.e(1,0,0),new l.e(0,0,1)),new d("down",new l.e(0,-1,0),new l.e(1,0,0),new l.e(0,0,-1)),new d("front",new l.e(0,0,1),new l.e(1,0,0),new l.e(0,-1,0)),new d("back",new l.e(0,0,-1),new l.e(-1,0,0),new l.e(0,-1,0))],m.MAX_HDRI_VALUE=4096,m.PRESERVE_CLAMPED_COLORS=!1;var P=r(2854);P.a.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(P.a.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=m.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0})}}]);
